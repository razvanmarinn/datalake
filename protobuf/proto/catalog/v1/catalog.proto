syntax = "proto3";
package catalog.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/razvanmarinn/datalake/protobuf/gen/go/catalog/v1;catalogv1";

service CatalogService {
  rpc GetProject(GetProjectRequest) returns (GetProjectResponse);

  rpc RegisterDataFile(RegisterDataFileRequest) returns (RegisterDataFileResponse);
  rpc PollCompactionJobs(PollCompactionJobsRequest) returns (PollCompactionJobsResponse);
  rpc UpdateJobStatus(UpdateJobStatusRequest) returns (UpdateJobStatusResponse);
}

message PollCompactionJob {
  string job_id = 1;
  string project_id = 2;
  string schema_name = 3;
  repeated string target_files = 4;
  string project_name = 5;
  repeated string target_paths = 6;
}

message GetProjectRequest {
  string project_name = 1;
}

message GetProjectResponse {
  string project_id = 1;
  string owner_id = 2;
  google.protobuf.Timestamp created_at = 3;
}

message PollCompactionJobsRequest {}

message PollCompactionJobsResponse {
  repeated PollCompactionJob jobs = 1;
}

message UpdateJobStatusRequest {
  string job_id = 1;
  string status = 2;
  string result_file_path = 3;
}

message UpdateJobStatusResponse {
  bool success = 1;
}

message RegisterDataFileRequest {
  string project_id = 1;
  string schema_name = 2;
  string block_id = 3;
  string worker_id = 4;
  string file_path = 5;
  int64 file_size = 6;
  string file_format = 7;
}

message RegisterDataFileResponse {
  bool success = 1;
}
